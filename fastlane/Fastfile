# Generated by AI-Enhanced Automation
# Tue Sep 23 15:41:23 CDT 2025
# Updated: February 10, 2026 - Added deployment lanes

platform :ios do
  desc 'Run tests'
  lane :test do
    run_tests(
      project: 'AvoidObstaclesGame.xcodeproj',
      scheme: 'AvoidObstaclesGame',
      clean: true,
      code_coverage: true
    )
  end

  desc 'Build for development'
  lane :build_dev do
    build_ios_app(
      project: 'AvoidObstaclesGame.xcodeproj',
      scheme: 'AvoidObstaclesGame',
      configuration: 'Debug',
      clean: true
    )
  end

  desc 'Build for release'
  lane :build_release do
    build_ios_app(
      project: 'AvoidObstaclesGame.xcodeproj',
      scheme: 'AvoidObstaclesGame',
      configuration: 'Release',
      clean: true,
      export_method: 'app-store'
    )
  end

  desc "Build and deploy to TestFlight"
  lane :beta do
    # Ensure clean git status
    ensure_git_status_clean

    # Increment build number
    increment_build_number(
      build_number: ENV["BUILD_NUMBER"] || Time.now.to_i.to_s
    )

    # Build the app
    build_app(
      scheme: "AvoidObstaclesGame",
      configuration: "Release",
      clean: true,
      export_method: "app-store",
      export_options: {
        provisioningProfiles: {
          ENV["BUNDLE_IDENTIFIER"] => ENV["PROVISIONING_PROFILE_NAME"]
        }
      }
    )

    # Upload to TestFlight
    upload_to_testflight(
      username: ENV["APPLE_ID"],
      app_identifier: ENV["BUNDLE_IDENTIFIER"],
      skip_waiting_for_build_processing: true
    )
  end

  desc "Build and deploy to App Store"
  lane :release do
    # Ensure clean git status
    ensure_git_status_clean

    # Increment build number
    increment_build_number(
      build_number: ENV["BUILD_NUMBER"] || Time.now.to_i.to_s
    )

    # Build the app
    build_app(
      scheme: "AvoidObstaclesGame",
      configuration: "Release",
      clean: true,
      export_method: "app-store",
      export_options: {
        provisioningProfiles: {
          ENV["BUNDLE_IDENTIFIER"] => ENV["PROVISIONING_PROFILE_NAME"]
        }
      }
    )

    # Upload to App Store Connect
    deliver(
      username: ENV["APPLE_ID"],
      app_identifier: ENV["BUNDLE_IDENTIFIER"],
      skip_screenshots: true,
      skip_metadata: true,
      submit_for_review: false,
      automatic_release: false
    )
  end
end
